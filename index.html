<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Для тебя — личный сайт‑подарок</title>
  <meta name="description" content="Нежный сайт‑послание: наши моменты, лирика и фото‑альбом." />
  <meta property="og:title" content="Для тебя" />
  <meta property="og:description" content="Наши моменты, лирика и фото‑альбом." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#f7e6eb" />
  <link rel="preload" as="image" href="photos/cover.jpg" />
  <style>
    :root{
      --bg:#fff9fb;
      --card:#ffffff;
      --ink:#1f1d22;
      --muted:#6e6470;
      --rose:#ff8fb1;
      --rose-2:#ffd0dc;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --rad:20px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;scroll-behavior:smooth}
    body{font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Noto Sans", "Helvetica Neue", sans-serif; color:var(--ink); background:linear-gradient(180deg, var(--bg), #fff)}
    a{color:var(--rose);text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:24px}

    /* HERO */
    .hero{min-height:88dvh;display:grid;place-items:center;padding:24px;background:radial-gradient(1200px 600px at 70% -10%, #ffeef6 0%, transparent 60%), url('photos/cover.jpg') center/cover fixed no-repeat;position:relative;}
    .veil{position:absolute;inset:0;background:rgba(255,255,255,.55);backdrop-filter: blur(2px)}
    .hero-card{position:relative;z-index:1;max-width:760px;background:var(--card);box-shadow:var(--shadow);border-radius:var(--rad);padding:32px 28px;border:1px solid #f5e3ea}
    .title{font-size:clamp(28px, 3.6vw, 54px);letter-spacing:.5px;margin:0 0 10px;font-weight:800}
    .subtitle{margin:0;color:var(--muted);font-size:clamp(14px,1.6vw,18px)}
    .cta{margin-top:22px;display:flex;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border:0;border-radius:999px;padding:12px 18px;cursor:pointer;font-weight:700;box-shadow:var(--shadow);transition:.2s transform, .2s box-shadow;background:var(--rose);color:#fff}
    .btn.alt{background:#fff;color:var(--ink);border:1px solid #eee}
    .btn:hover{transform:translateY(-2px)}

    /* SECTIONS */
    .section{padding:64px 0}
    .section h2{font-size:clamp(22px,2.4vw,34px);margin:0 0 18px}
    .lead{color:var(--muted);max-width:720px}

    /* TIMELINE */
    .timeline{display:grid;gap:18px;margin-top:24px}
    .moment{background:var(--card);border:1px solid #f3e7ed;border-radius:16px;padding:18px 18px;box-shadow:var(--shadow);display:grid;grid-template-columns:90px 1fr;gap:16px;align-items:center}
    .moment .date{font-weight:800;color:#b15374}
    .moment .text{color:#40363f}

    /* GALLERY */
    .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(180px,1fr));gap:14px;margin-top:26px}
    .ph{position:relative;overflow:hidden;border-radius:14px;border:1px solid #f0e5ea;background:#fff}
    .ph img{width:100%;height:220px;object-fit:cover;display:block;transition:transform .35s ease}
    .ph:hover img{transform:scale(1.04)}
    .ph .cap{position:absolute;left:0;right:0;bottom:0;background:linear-gradient(180deg, transparent, rgba(0,0,0,.55));color:#fff;padding:10px 12px;font-size:14px}

    /* LIGHTBOX */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:50}
    .lightbox.open{display:flex}
    .lb-inner{position:relative;max-width:min(92vw,1100px);max-height:86vh}
    .lb-inner img{max-width:100%;max-height:86vh;border-radius:12px;display:block}
    .lb-cap{color:#fff;text-align:center;margin-top:10px}
    .lb-x,.lb-prev,.lb-next{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.9);border:0;border-radius:999px;width:42px;height:42px;display:grid;place-items:center;cursor:pointer}
    .lb-x{top:-18px;right:-18px;transform:none}
    .lb-prev{left:-56px}
    .lb-next{right:-56px}
    @media (max-width:800px){.lb-prev{left:6px}.lb-next{right:6px}.lb-x{right:6px;top:6px}}

    /* SECRET LETTER */
    .secret{margin-top:30px;display:flex;align-items:center;gap:10px}
    .heart{width:28px;height:28px;display:inline-grid;place-items:center;border-radius:50%;background:var(--rose-2);border:1px solid #f2c4d1;cursor:pointer;transition:transform .2s}
    .heart:hover{transform:scale(1.08)}

    /* PLAYER */
    .player{display:flex;align-items:center;gap:10px;margin-top:14px}

    /* FOOTER */
    footer{padding:40px 0 60px;color:#7b6c76;text-align:center}

    /* SMALL UTIL */
    .card{background:var(--card);border:1px solid #f3e7ed;border-radius:16px;padding:18px;box-shadow:var(--shadow)}

    /* DEV TEST BADGE */
    #testBadge{position:fixed;right:12px;bottom:12px;padding:6px 10px;border-radius:999px;font-size:12px;background:#eee;color:#333;box-shadow:var(--shadow);display:none}
    #testBadge.ok{background:#d8f5d0}
    #testBadge.fail{background:#ffd7d7}
  </style>
</head>
<body>
  <!-- HERO -->
  <section class="hero" id="home" aria-label="Hero">
    <div class="veil" aria-hidden="true"></div>
    <div class="hero-card">
      <h1 class="title">Для тебя</h1>
      <p class="subtitle">Мне нравится, как прошлое шепчет и будущее улыбается, когда я думаю о нас.</p>
      <div class="cta">
        <a class="btn" href="#moments">Наши моменты</a>
        <button class="btn alt" id="playBtn" aria-label="Воспроизвести музыку">▶︎ Музыка</button>
      </div>
      <div class="player">
        <audio id="song" preload="auto" src="audio/your-song.mp3"></audio>
        <small style="color:var(--muted)">*</small>
      </div>
      <div class="secret" title="Небольшой сюрприз">
        <span>Секретное письмо</span>
        <button class="heart" id="heart" aria-label="Открыть секрет">❤</button>
        <small class="muted" style="color:var(--muted)">кликни сердечко три раза</small>
      </div>
    </div>
  </section>

  <!-- TIMELINE / LYRICS -->
  <section class="section" id="words">
    <div class="container">
      <h2>Лирика</h2>
      <p class="lead">Пусть слова будут простыми, как дыхание — без лишнего сахара, зато честно и навсегда.</p>
      <div class="timeline" id="timeline"></div>
    </div>
  </section>

  <!-- GALLERY -->
  <section class="section" id="moments">
    <div class="container">
      <h2>Наши моменты</h2>
      <p class="lead">Здесь — фрагменты нашей истории. Листай, вспоминай, улыбайся.</p>
      <div class="grid" id="gallery"></div>
    </div>
  </section>

  <footer>Сделано с вниманием и упрямой нежностью.</footer>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Просмотр фото">
    <div class="lb-inner">
      <img id="lbImg" alt="" />
      <div class="lb-cap" id="lbCap"></div>
      <button class="lb-x" id="lbClose" aria-label="Закрыть">✕</button>
      <button class="lb-prev" id="lbPrev" aria-label="Предыдущее">◀</button>
      <button class="lb-next" id="lbNext" aria-label="Следующее">▶</button>
    </div>
  </div>

  <!-- SECRET MODAL -->
  <dialog id="secretModal" style="border:0;border-radius:16px;padding:0;max-width:min(92vw,720px);">
    <form method="dialog" style="margin:0">
      <div class="card">
        <h3 style="margin-top:6px">Письмо</h3>
        <p id="secretText" style="color:#3b3238"></p>
        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px">
          <button class="btn alt">Закрыть</button>
        </div>
      </div>
    </form>
  </dialog>

  <noscript>Для просмотра сайта включите JavaScript.</noscript>
  <div id="testBadge" aria-live="polite"></div>

  <script>
    const LYRICS = [
      { date: 'Первая встреча', text: 'Я не искал пути и не считал шагов — просто увидел тебя и понял: домой.' },
      { date: 'Тёплый вечер', text: 'Мы смеялись над глупостями, пока город зажигал фонари, как небесные веснушки.' },
      { date: 'Обещание', text: 'Если сомнения — я рядом. Если радость — разделим. Если ночь — я доскажу за звёзды.' },
    ];

    const IMAGES = [
      { src: 'photos/1.jpg', cap: 'Тот самый взгляд' },
      { src: 'photos/2.jpg', cap: 'Смешной кадр' },
      { src: 'photos/3.jpg', cap: 'Наш рассвет' },
      { src: 'photos/4.jpg', cap: 'И ещё момент' },
    ];

    function nextIndex(current, dir, length){
      if(!Number.isInteger(current) || !Number.isInteger(dir) || !Number.isInteger(length) || length<=0){
        throw new Error('nextIndex(): invalid args');
      }
      return (current + dir + length) % length;
    }

    // RENDER TIMELINE
    const tl = document.getElementById('timeline');
    LYRICS.forEach(m => {
      const el = document.createElement('div');
      el.className = 'moment';
      el.innerHTML = `<div class="date">${m.date}</div><div class="text">${m.text}</div>`;
      tl.appendChild(el);
    });

    // RENDER GALLERY
    const gal = document.getElementById('gallery');
    IMAGES.forEach((p, idx) => {
      const card = document.createElement('a');
      card.href = p.src;
      card.className = 'ph';
      card.dataset.index = idx;
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.src = p.src;
      img.alt = p.cap || '';
      img.onerror = () => { img.alt = 'Фото не найдено'; };
      const cap = document.createElement('div');
      cap.className = 'cap';
      cap.textContent = p.cap || '';
      card.appendChild(img);
      card.appendChild(cap);
      card.addEventListener('click', (e)=>{ e.preventDefault(); openLightbox(idx); });
      gal.appendChild(card);
    });

    // LIGHTBOX
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbCap = document.getElementById('lbCap');
    const lbClose = document.getElementById('lbClose');
    const lbPrev = document.getElementById('lbPrev');
    const lbNext = document.getElementById('lbNext');
    let current = 0;

    function updateLightbox(){
      const p = IMAGES[current];
      lbImg.src = p.src; lbImg.alt = p.cap || '';
      lbCap.textContent = p.cap || '';
    }
    function openLightbox(i){
      current = i; updateLightbox();
      lb.classList.add('open');
      document.body.style.overflow='hidden';
    }
    function closeLightbox(){
      lb.classList.remove('open');
      document.body.style.overflow='auto';
    }
    function step(dir){
      current = nextIndex(current, dir, IMAGES.length);
      updateLightbox();
    }
    lbClose.addEventListener('click', closeLightbox);
    lbPrev.addEventListener('click', ()=>step(-1));
    lbNext.addEventListener('click', ()=>step(1));
    lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });
    window.addEventListener('keydown', (e)=>{
      if(!lb.classList.contains('open')) return;
      if(e.key==='Escape') closeLightbox();
      if(e.key==='ArrowLeft') step(-1);
      if(e.key==='ArrowRight') step(1);
    });

    // AUDIO
    const song = document.getElementById('song');
    const playBtn = document.getElementById('playBtn');
    let playing = false;
    playBtn.addEventListener('click', async()=>{
      try{
        if(!playing){ await song.play(); playing = true; playBtn.textContent = '⏸ Пауза'; }
        else { song.pause(); playing = false; playBtn.textContent = '▶︎ Музыка'; }
      }catch(err){ alert('Браузер заблокировал автозапуск. Попробуй ещё раз.'); }
    });

    // SECRET
    const heart = document.getElementById('heart');
    const secretModal = document.getElementById('secretModal');
    const secretText = document.getElementById('secretText');
    const SECRET_MESSAGE = 'Ты — моё любимое совпадение. Если мир когда‑нибудь спросит, где мой дом — я назову твоё имя.';
    let clicks = 0; let timer;
    function resetSecretCounter(){ clicks = 0; clearTimeout(timer); }
    function secretClick(){
      clicks++; clearTimeout(timer);
      if(clicks>=3){
        resetSecretCounter();
        secretText.textContent = SECRET_MESSAGE;
        if(typeof secretModal.showModal === 'function') secretModal.showModal();
        else alert(SECRET_MESSAGE);
        return true;
      } else {
        timer = setTimeout(()=> clicks=0, 900);
        return false;
      }
    }
    heart.addEventListener('click', secretClick);

    // DEV TESTS
    (function runTests(){
      const badge = document.getElementById('testBadge');
      const results = [];
      function ok(name, cond){ results.push({name, pass: !!cond}); }
      function eq(name, a, b){ ok(name+` (ожидалось ${b}, получено ${a})`, Object.is(a,b)); }

      try{
        ok('LYRICS — массив', Array.isArray(LYRICS));
        ok('IMAGES — массив', Array.isArray(IMAGES));
        ok('IMAGES — не пустой', IMAGES.length > 0);
        ok('IMAGES[0].src — строка', typeof IMAGES[0].src === 'string');

        eq('nextIndex(0,-1,4) === 3', nextIndex(0,-1,4), 3);
        eq('nextIndex(3,1,4) === 0', nextIndex(3,1,4), 0);
        eq('nextIndex(1,0,4) === 1', nextIndex(1,0,4), 1);

        current = 0; step(-1); eq('step(-1) с нуля уходит на последний', current, 3);
        step(1); eq('step(1) возвращает к 0', current, 0);

        resetSecretCounter();
        const a = secretClick();
        const b = secretClick();
        const c = secretClick();
        ok('secretClick() открывает модалку на третьем клике', a===false && b===false && c===true);

        const allPass = results.every(r=>r.pass);
        badge.textContent = allPass ? 'Tests: OK' : 'Tests: FAIL';
        badge.className = allPass ? 'ok' : 'fail';
        badge.style.display = 'block';
        if(!allPass){ console.group('DEV TESTS'); results.forEach(r=>console[r.pass?'log':'error'](r.pass?'✓':'✗', r.name)); console.groupEnd(); }
      }catch(e){
        badge.textContent = 'Tests: ERROR';
        badge.className = 'fail';
        badge.style.display = 'block';
        console.error('Test runner error:', e);
      }
    })();
  </script>
</body>
</html>
